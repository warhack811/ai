from __future__ import annotations

from dataclasses import dataclass
from typing import List

from duckduckgo_search import DDGS  # type: ignore

from core.logger import get_logger

logger = get_logger(__name__)


@dataclass
class DuckResult:
    title: str
    url: str
    snippet: str


def duck_search(query: str, max_results: int = 5) -> List[DuckResult]:
    results: List[DuckResult] = []

    try:
        with DDGS() as ddgs:
            for r in ddgs.text(
                query,
                max_results=max_results,
                region="tr-tr",
                safesearch="moderate",
            ):
                title = r.get("title") or ""
                url = r.get("href") or ""
                snippet = r.get("body") or ""
                if not title and not snippet:
                    continue

                results.append(
                    DuckResult(
                        title=title,
                        url=url,
                        snippet=snippet,
                    )
                )
    except Exception as e:
        logger.warning(f"[DUCK] Arama sırasında sorun: {e}")

    logger.info(f"[DUCK] '{query}' için {len(results)} sonuç döndü.")
    return results
